<!DOCTYPE html>
<html th:replace="~{layout/default :: layout(~{::title}, ~{::section})}" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>비밀번호 변경</title>
</head>
<body>
<section>
    <div class="col-md-4 col-md-offset-4">
        <div class="panel panel-red">
            <div class="panel-heading">
                <h3 class="panel-title">비밀번호 변경</h3>
            </div>
            <input type="hidden" name="nowPwdDB" id="nowPwdDB" th:value="${employeInfo.password}"/>
            <div class="panel-body">
                <form class="form-signin" method="POST">
                    <fieldset>
                        <div><label>현재비밀번호</label></div>
                        <div class="form-group">
                            <input type="password" name="nowPwd" id="nowPwd" class="form-control" placeholder="현재비밀번호" required="required" autofocus="autofocus" />
                        </div>
                        <div><label>새 비밀번호</label></div>
                        <div class="form-group">
                            <input type="password" name="pwd1" id="pwd1" class="form-control" placeholder="새 비밀번호" value="" required="required" />
                        </div>
                        <div><label>새 비밀번호 확인</label></div>
                        <div class="form-group">
                            <input type="password" name="pwd2" id="pwd2" class="form-control" placeholder="새 비밀번호 확인" value="" required="required" />
                        </div>
                        <button class="btn btn-lg btn-danger btn-block" type="button" onclick="checkPwd();">변경</button>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
    <script>
        function checkPwd(){
            if($('#nowPwd').val() != $('#nowPwdDB').val()){ alert('현재비밀번호를 확인해주세요.'); return false;}

            if($('#pwd1').val().length<6){
                alert('비밀번호를 6자리 이상으로 설정해주세요.');
                return false;
            }else if($('#pwd1').val() != $('#pwd2').val()){
                alert('새로 입력한 비밀번호가 일치하지 않습니다.');
                return false;
            }

            $.ajax({
                url : '/updatePassword',
                type : 'post',
                dataType : 'text',
                data : {
                    password : $('#pwd1').val()
                },
                success : function(data){
                    if(data=='S'){
                        alert('비밀번호 변경이 완료되었습니다.');
                        document.location.href='/main';
                    }else{
                        alert('변경 중 에러가 발생하였습니다. 
에러가 계속될경우 기술개발팀에 문의해주세요.');
                    }
                },error : function(e){
                    alert('변경 중 에러가 발생하였습니다. 
에러가 계속될경우 기술개발팀에 문의해주세요.');
                    console.log(e);
                }
            });
        }
    </script>
</section>
</body>
</html>