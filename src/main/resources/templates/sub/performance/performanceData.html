<!DOCTYPE html>
<html th:replace="~{layout/default :: layout(~{::title}, ~{::section})}" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>성과 / 가치평가</title>
</head>
<body>
<section th:with="
    useAuthLevel = (${performanceScore.confirm1} == ${session.employeId}) ? 1 : ((${performanceScore.confirm2} == ${session.employeId}) ? 2 : ${session.authLevel}),
    valueScoreTot1 = 0,
    valueScoreTot2 = 0,
    useAuth0 = (${performanceScore.employeId} == ${session.employeId} and ${performanceScore.dissentComments1} == null and ${performanceScore.dissentComments2} == null),
    useAuth1 = (${performanceScore.confirm1} == ${session.employeId} and ${performanceScore.dissent} != null and (${performanceScore.dissentComments1} == null or ${performanceScore.dissentComments2} == null)),
    useAuth2 = (${performanceScore.confirm2} == ${session.employeId} and ${performanceScore.dissent} != null and (${performanceScore.dissentComments1} == null or ${performanceScore.dissentComments2} == null))
">
    <script th:if="${!performanceScore.employeId.equals(session.employeId) && useAuthLevel==0}">
        alert('잘못된 접근입니다.');
        document.location.href = '/main';
    </script>
    <div class="row">
        <div><h2 class="page-header">성과 / 가치평가</h2></div>
        <div class="panel panel-red">
            <div class="panel-heading">성과 / 가치평가</div>
            <div class="panel-body  centerText">
                <table class="table" id="dataTables-example">
                    <tbody>
                    <tr>
                        <td class="col-lg-12">
                            <div class="form-group col-lg-14">
                                <div class="col-xs-1"><label class="form-inline">이름</label></div>
                                <div class="col-xs-2">
                                    <input type="text" th:value="${performanceScore.employeName}" readonly="readonly"/>
                                    <input type="hidden" id="employeId" name="employeId" th:value="${performanceScore.employeId}"/>
                                    <input type="hidden" id="month" name="month" th:value="${performanceScore.month}"/>
                                    <input type="hidden" id="useAuthLevel" name="useAuthLevel" th:value="${useAuthLevel}"/>
                                </div>
                                <div class="col-xs-1"><label class="form-inline">부서</label></div>
                                <div class="col-xs-2">
                                    <input type="text" th:value="${performanceScore.divisionName}" readonly="readonly"/>
                                </div>
                                <div class="col-xs-1"><label class="form-inline">팀</label></div>
                                <div class="col-xs-2">
                                    <input type="text" th:value="${performanceScore.teamName}" readonly="readonly"/>
                                </div>
                                <div class="col-xs-1"><label class="form-inline">상태</label></div>
                                <div class="col-xs-2">
                                    <input type="text" th:value="${(performanceScore.score1 &gt; 0 and performanceScore.score2 &gt; 0) ? '평가완료' : ((performanceScore.score1 &gt; 0 or performanceScore.score2 &gt; 0) ? '평가중' : '미등록')}" readonly="readonly"/>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <!-- Other rows as per the JSP -->
                    </tbody>
                </table>
            </div>
            <div class="panel-body align-right">
                <div class="col-xs-2 pull-right"><button type="button" class="btn btn-danger btn-outline btn-sm btn-block" onclick="javascript:history.go(-1);">목록</button></div>
                <div class="col-xs-2 pull-right" th:if="${useAuth0 and performanceScore.score1 &gt; 0 and performanceScore.score2 &gt; 0}"><button type="button" class="btn btn-danger btn-sm btn-block" onclick="saveComments()">이의신청</button></div>
                <div class="col-xs-2 pull-right" th:if="${(useAuth1 || useAuth2)}"><button type="button" class="btn btn-danger btn-sm btn-block" th:onclick="'SavePerformData(' + ${useAuthLevel} + ')'">등록</button></div>
            </div>
        </div>
    </div>

    <script>
        function saveComments(){
            var dissent = $('#dissent').val();
            var employeId = $('#employeId').val();
            var month = $('#month').val();
            var useAuthLevel = $('#useAuthLevel').val();

            $.ajax({
                url : 'savePerformDissent',
                type : 'post',
                dataType : 'text',
                data : {employeId : employeId,
                        month : month,
                        dissent : dissent,
                        useAuthLevel : useAuthLevel
                        },
                success : function(res){
                    if(res=='S'){
                        alert('등록이 완료되었습니다.');
                        document.location.href='performanceList?yyyyMM='+month;
                    }else{
                        alert('등록중 에러가 발생하였습니다. \n에러가 계속될경우 기술개발팀에 문의해주세요.');
                    }
                },error : function(e){
                    alert('등록실패');
                    console.log(e);
                }
            });
        }
        // Other JS functions like SavePerformData would need to be defined as well.
    </script>
</section>
</body>
</html>
